var h=(n,s,e)=>new Promise((u,t)=>{var l=a=>{try{o(e.next(a))}catch(r){t(r)}},c=a=>{try{o(e.throw(a))}catch(r){t(r)}},o=a=>a.done?u(a.value):Promise.resolve(a.value).then(l,c);o((e=e.apply(n,s)).next())});import{_ as m}from"./FormControl.41ecd006.js";import{_ as v,a as F}from"./ListView.e4532d11.js";import{_ as y,o as f,d as b,f as w,u as S,F as k,G as T,a4 as P,a3 as U,N as j,g as p,C,D as E,w as g,A as O,t as A,V as D,W as N,v as L}from"./vendor.ae1af255.js";import"./index.de2b8369.js";class R{constructor(){this.listeners={},this.failed=!1}on(s,e){this.listeners[s]=this.listeners[s]||[],this.listeners[s].push(e)}trigger(s,e){(this.listeners[s]||[]).forEach(t=>{t.call(this,e)})}upload(s,e){return new Promise((u,t)=>{let l=new XMLHttpRequest;l.upload.addEventListener("loadstart",()=>{this.trigger("start")}),l.upload.addEventListener("progress",a=>{a.lengthComputable&&this.trigger("progress",{uploaded:a.loaded,total:a.total})}),l.upload.addEventListener("load",()=>{this.trigger("finish")}),l.addEventListener("error",()=>{this.trigger("error"),t()}),l.onreadystatechange=()=>{if(l.readyState==XMLHttpRequest.DONE){let a;if(l.status===200){let r=null;try{r=JSON.parse(l.responseText)}catch(i){r=l.responseText}let d=r.message||r;u(d)}else if(l.status===403)a=JSON.parse(l.responseText);else{this.failed=!0;try{a=JSON.parse(l.responseText)}catch(r){}}a&&a.exc&&console.error(JSON.parse(a.exc)[0]),t(a)}};const c=e.upload_endpoint||"/api/method/upload_file";l.open("POST",c,!0),l.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&l.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let o=new FormData;s&&o.append("file",s,s.name),o.append("is_private",e.private?"1":"0"),o.append("folder",e.folder||"Home"),e.file_url&&o.append("file_url",e.file_url),e.doctype&&o.append("doctype",e.doctype),e.docname&&o.append("docname",e.docname),e.fieldname&&o.append("fieldname",e.fieldname),e.method&&o.append("method",e.method),e.type&&o.append("type",e.type),l.send(o)})}}const J={name:"FileUploader",props:["fileTypes","uploadArgs","validateFile"],data(){return{uploader:null,uploading:!1,uploaded:0,error:null,message:"",total:0,file:null,finishedUploading:!1}},computed:{progress(){let n=Math.floor(this.uploaded/this.total*100);return isNaN(n)?0:n},success(){return this.finishedUploading&&!this.error}},methods:{openFileSelector(){this.$refs.input.click()},onFileAdd(n){return h(this,null,function*(){if(this.error=null,this.file=n.target.files[0],this.file&&this.validateFile)try{let s=yield this.validateFile(this.file);s&&(this.error=s)}catch(s){this.error=s}this.error||this.uploadFile(this.file)})},uploadFile(n){return h(this,null,function*(){this.error=null,this.uploaded=0,this.total=0,this.uploader=new R,this.uploader.on("start",()=>{this.uploading=!0}),this.uploader.on("progress",s=>{this.uploaded=s.uploaded,this.total=s.total}),this.uploader.on("error",()=>{this.uploading=!1,this.error="Error Uploading File"}),this.uploader.on("finish",()=>{this.uploading=!1,this.finishedUploading=!0}),this.uploader.upload(n,this.uploadArgs||{}).then(s=>{this.$emit("success",s)}).catch(s=>{this.uploading=!1;let e="Error Uploading File";(s==null?void 0:s._server_messages)?e=JSON.parse(JSON.parse(s._server_messages)[0]).message:(s==null?void 0:s.exc)&&(e=JSON.parse(s.exc)[0].split(`
`).slice(-2,-1)[0]),this.error=e,this.$emit("failure",s)})})}}},z=["accept"];function I(n,s,e,u,t,l){return f(),b("div",null,[w("input",{ref:"input",type:"file",accept:e.fileTypes,class:"hidden",onChange:s[0]||(s[0]=(...c)=>l.onFileAdd&&l.onFileAdd(...c))},null,40,z),S(n.$slots,"default",k(T({file:t.file,uploading:t.uploading,progress:l.progress,uploaded:t.uploaded,message:t.message,error:t.error,total:t.total,success:l.success,openFileSelector:l.openFileSelector})))])}var M=y(J,[["render",I]]);const B={class:"p-2",style:{padding:"10px","text-align":"left"}},H={style:{display:"flex","justify-content":"end"}},q={__name:"NewProduct",setup(n){const s=r=>{},e=P({modelValuebarcode:"",modelValuecode:"",modelValue:"",valueName:"",valueDescription:"",simple_rows:[]}),u=[{label:"\u0110\u01B0\u1EDDng d\u1EABn \u1EA3nh",key:"uri_image",width:"30%"}],t=U(),l=j({doctype:"Product"}),c=()=>{let r={docstatus:0,doctype:"Product",category:"Th\u1EF1c ph\u1EA9m nhanh",barcode:e.modelValuebarcode,product_code:e.modelValuecode,product_name:e.valueName,product_description:e.valueDescription,photos:e.simple_rows};D({url:"frappe.desk.form.save.savedocs",method:"POST",headers:{"Content-Type":"application/json"},params:{doc:JSON.stringify(r),action:"Save"},onSuccess(i){console.log(i),alert("Add succesfully")},onError(i){console.log(i)}}).reload(),l.reload(),t.push("/"),t.afterEach(()=>{location.reload()})},o={doctype:"Product_Image",fieldname:"uri_image",docname:"new-product-jrxairrkzl"},a=r=>{let d={docstatus:0,doctype:"Product_Image",name:"new-product_image-buhawsuxpf",owner:r.owner,parent:"new-product-xjwkkysins",parentfield:"photos",parenttype:"Product",uri_image:r.file_url};e.simple_rows.push(d),console.log(e.simple_rows)};return(r,d)=>(f(),b("div",B,[w("div",H,[p(C(E),{options:[{label:"Th\xEAm s\u1EA3n ph\u1EA9m",value:"1"},{label:"X\xF3a s\u1EA3n ph\u1EA9m",value:"1"},{label:"In",value:"1"},{label:"Sao ch\xE9p",value:"1"}],button:{label:"..."},style:{"margin-right":"10px"}},null,8,["button"]),p(v,{onClick:c,class:"btn-save"},{default:g(()=>[N("Save")]),_:1})]),p(m,{type:"text",size:"sm",variant:"subtle",placeholder:"Nh\u1EADp m\xE3 s\u1EA3n ph\u1EA9m",disabled:!1,label:"M\xE3 s\u1EA3n ph\u1EA9m (Bar code)",modelValue:e.modelValuebarcode,"onUpdate:modelValue":d[0]||(d[0]=i=>e.modelValuebarcode=i),class:"pdd-class"},null,8,["modelValue"]),p(m,{type:"text",size:"sm",variant:"subtle",placeholder:"Nh\u1EADp m\xE3 s\u1EA3n ph\u1EA9m",disabled:!1,label:"M\xE3 s\u1EA3n ph\u1EA9m",modelValue:e.modelValuecode,"onUpdate:modelValue":d[1]||(d[1]=i=>e.modelValuecode=i),class:"pdd-class"},null,8,["modelValue"]),p(m,{type:"text",size:"sm",variant:"subtle",placeholder:"Nh\u1EADp t\xEAn s\u1EA3n ph\u1EA9m",disabled:!1,label:"T\xEAn s\u1EA3n ph\u1EA9m",modelValue:e.valueName,"onUpdate:modelValue":d[2]||(d[2]=i=>e.valueName=i),class:"pdd-class"},null,8,["modelValue"]),p(m,{type:"select",size:"sm",variant:"subtle",placeholder:"Nh\u1EADp lo\u1EA1i s\u1EA3n ph\u1EA9m",disabled:!1,label:"Lo\u1EA1i s\u1EA3n ph\u1EA9m",options:[{label:"Th\u1EF1c ph\u1EA9m nhanh",value:"1"}],class:"pdd-class"}),p(M,{class:"pdd-class",fileTypes:["image/*"],uploadArgs:o,validateFile:s,onSuccess:a},{default:g(({file:i,uploading:_,progress:x,uploaded:X,message:$,error:G,total:W,success:K,openFileSelector:V})=>[p(v,{onClick:V,loading:_},{default:g(()=>[N(L(_?`Uploading ${x}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])]),_:1}),e.simple_rows.length>0?(f(),O(F,{key:0,class:"h-auto pdd-class",columns:u,rows:e.simple_rows,options:{selectable:!0,showTooltip:!0},"row-key":"id"},null,8,["rows"])):A("",!0),p(m,{type:"textarea",size:"sm",variant:"subtle",placeholder:"Nh\u1EADp m\xF4 t\u1EA3 s\u1EA3n ph\u1EA9m",disabled:!1,label:"M\xF4 t\u1EA3",modelValue:e.valueDescription,"onUpdate:modelValue":d[3]||(d[3]=i=>e.valueDescription=i),class:"pdd-class"},null,8,["modelValue"])]))}};var le=y(q,[["__scopeId","data-v-38248cd4"]]);export{le as default};
